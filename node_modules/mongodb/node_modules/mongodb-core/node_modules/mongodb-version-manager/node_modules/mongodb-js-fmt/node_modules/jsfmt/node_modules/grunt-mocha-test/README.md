# grunt-mocha-test

[![Build Status](https://travis-ci.org/pghalliday/grunt-mocha-test.svg)](https://travis-ci.org/pghalliday/grunt-mocha-test)
[![Coverage Status](https://img.shields.io/coveralls/pghalliday/grunt-mocha-test.svg)](https://coveralls.io/r/pghalliday/grunt-mocha-test?branch=master)
[![Dependency Status](https://david-dm.org/pghalliday/grunt-mocha-test.svg?theme=shields.io)](https://david-dm.org/pghalliday/grunt-mocha-test)
[![devDependency Status](https://david-dm.org/pghalliday/grunt-mocha-test/dev-status.svg?theme=shields.io)](https://david-dm.org/pghalliday/grunt-mocha-test#info=devDependencies)
[![peerDependency Status](https://david-dm.org/pghalliday/grunt-mocha-test/peer-status.svg?theme=shields.io)](https://david-dm.org/pghalliday/grunt-mocha-test#info=peerDependencies)

A grunt task for running server side mocha tests

## Usage

Install next to your project's Gruntfile.js with: 

```
npm install grunt-mocha-test --save-dev
```

Note that due to some dependencies using newer features of `npm` it is necessary to update `npm` if still using the default version that ships with node 0.8. This can be done as follows:

```
npm update npm -g 
```

On some systems it may be necessary to run this with `sudo`

### Running tests

Here is a simple example gruntfile if you just want to run tests

```javascript
module.exports = function(grunt) {

  // Add the grunt-mocha-test tasks.
  grunt.loadNpmTasks('grunt-mocha-test');

  grunt.initConfig({
    // Configure a mochaTest task
    mochaTest: {
      test: {
        options: {
          reporter: 'spec',
          captureFile: 'results.txt', // Optionally capture the reporter output to a file
          quiet: false, // Optionally suppress output to standard out (defaults to false)
          clearRequireCache: false // Optionally clear the require cache before running tests (defaults to false)
        },
        src: ['test/**/*.js']
      }
    }
  });

  grunt.registerTask('default', 'mochaTest');

};
```

### Options

The following options are specific to `grunt-mocha-test` (ie. not mocha options)

- `captureFile` - specify a file to capture all output to (will include any output from `console.log`)
- `quiet` - `true` to not output anything to console (normally used with the `captureFile` option when console output would not be human readable)
- `clearRequireCache` - `true` to clear the require cache before each test run (normally used with watch when not spawning each test run in a new `nodejs` context)

The following mocha options have also been tested (others may have been added since the time of writing through changes to mocha)

- grep
- ui
- reporter
- timeout
- invert
- ignoreLeaks
- growl
- globals
- bail
- require
- colors (specify as "colors: true")
- slow

### Specifying compilers

The Mocha `--compilers` option is almost identical to the `--require` option but with additional functionality for use with the Mocha `--watch` mode. As the `--watch` mode is not relevant for this plugin there is no need to implement a separate `compilers` option and actually the `require` option should be used instead.

The following example shows the use of the CoffeeScript compiler.

```
npm install coffee-script
```

```javascript
mochaTest: {
  test: {
    options: {
      reporter: 'spec',
      require: 'coffee-script/register'
    },
    src: ['test/**/*.coffee']
  }
}
```

In order to make this more user friendly, the `require` option can take either a single file/function or an array of files/functions in case you have other globals you wish to require.

eg.

```javascript
mochaTest: {
  test: {
    options: {
      reporter: 'spec',
      require: [
        'coffee-script/register',
        './globals.js',
        function(){ testVar1=require('./stuff'); },
        function(){ testVar2='other-stuff'; }
      ]
    },
    src: ['test/**/*.coffee']
  }
}
```

NB. File references for the `require` option can only be used with Javascript files, ie. it is not possible to specify a `./globals.coffee` in the above example.

### Specifying a Mocha module

`grunt-mocha-t