#!/usr/bin/env node
var args = process.argv.slice(2)

var fs = require('fs')
if (!args.length && process.stdin.isTTY) {
  console.error(usage())
  process.exit(1)
}

process.stdout.on('error', function (er) {
  if (er.code === 'EPIPE')
    process.exit()
  else
    throw er
})

// defaults
var nodeArgs = []

var spawn = require('child_process').spawn
var fg = require('foreground-child')
var signalExit = require('signal-exit')
var opener = require('opener')

var timeout = process.env.TAP_TIMEOUT || 30
// coverage tools run slow.
if (global.__coverage__)
  timeout = 240

var color = require('supports-color')
if (process.env.TAP_COLORS !== undefined)
  color = !!(+process.env.TAP_COLORS)
var reporter
var files = []
var bail = false
var saveFile = null

var singleFlags = {
  b: 'bail',
  B: 'no-bail',
  c: 'color',
  C: 'no-color',
  h: 'help',
  '?': 'help',
  v: 'version'
}
var singleOpts = {
  R: 'reporter',
  t: 'timeout',
  s: 'save'
}

// If we're running under Travis-CI with a Coveralls.io token,
// then i